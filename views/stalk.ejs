<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
<style>
    #stalker-container > li {
        margin-top: 1em;
    }

    #stalker-container > li:first-child {
        margin-top: 0;
    }
</style>
<ol id="stalker-container"></ol>
<script>
    let id = '';
    const socket = io();
    socket.on('stuff', updateStalk);
    socket.on('init', ({ id: uid, data }) => {
        id = uid;
        updateStalk(data);
    });

    function updateStalk(data) {
        const root = document.getElementById('stalker-container');

        root.innerHTML = '';

        data
            .forEach(([ id, entries ]) => {
                const ol = document.createElement('ol');
                ol.className = 'stalker-group';

                entries.forEach((entry) => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="https://whatismyipaddress.com/ip/${entry.ip}">IP</a> [<img src="https://www.countryflags.io/${entry.geo.country}/flat/24.png" alt="${entry.geo.country}" title="${entry.geo.country}, ${entry.geo.region}"> | ${entry.geo.city}] <a href="http://localhost${entry.location.page}">${entry.location.title || entry.location.page}</a>`;
                    ol.appendChild(li);
                });

                const li = document.createElement('li');
                li.className = 'stalker-group-container';

                const div = document.createElement('div');
                div.innerText = id;
                li.appendChild(div);

                li.appendChild(ol);

                root.appendChild(li);
            });
    }

    function fetchData() {
        socket.emit('data', updateStalk);
    }

    setInterval(fetchData, 15 * 1000);
</script>
