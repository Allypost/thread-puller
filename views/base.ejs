<!doctype html>
<%
if (!locals.page) {
    locals.settings = false;
    locals.title = 'ThreadPuller - 404';
    locals.styles = ResourceWatcher.getAssets($_styles, 'global');
}
-%>
<html lang="en">
    <head>
        <%- include _/head.ejs -%>
    </head>
    <body>
        <div id="wrap">
            <% if(!locals.page) { -%>
                <%- include 404.ejs -%>
            <% } else { -%>
                <%- include _/scripts.ejs -%>
                <%- include(locals.page, locals) -%>

                <% if(settings) { %>
                    <%- include _/settings.ejs -%>
                <% } -%>
            <% } %>
        </div>
        <%- include _/footer.ejs -%>
        <%- include _/analytics.ejs -%>
        <script>
            var __tp = function () {
                <%
                if(presence.port)
                    socketUrl = `${presence.domain}:${presence.port}`;
                else
                    socketUrl = presence.domain;
                %>
                var socket = io('<%= socketUrl -%>');
                socket.on('connect', function () {
                    socket.emit('location', { link: window.location.href, page: window.location.pathname })
                });
                __tp = undefined;
            }
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js" <%- `onload="__tp()"` -%>></script>
    </body>
</html>
